/**
 * iphoneSlide - jQuery plugin
 * @version: 0.48 (2010/08/30)
 * @requires jQuery v1.3.2 or later 
 * @author Hina, Cain Chen. hinablue [at] gmail [dot] com
 * Examples and documentation at: http://jquery.hinablue.me/jqiphoneslide
 
 * Dual licensed under the MIT and GPL licenses:
 *   http://www.opensource.org/licenses/mit-license.php
 *   http://www.gnu.org/licenses/gpl.html
**/
(function(a){var b={handler:undefined,pageHandler:undefined,slideHandler:undefined,nextPageHandler:".nextPage",prevPageHandler:".prevPage",draglaunch:.5,friction:.325,sensitivity:20,extrashift:800,touchduring:800,direction:"horizontal",maxShiftPage:5,easing:"swing",pageshowfilter:!1,onShiftComplete:function(){}};a.fn.iphoneSlide=function(c,d){function i(a,b,c){var d=a.parent(),f=a,g=b,i=c,j=d.data("matrixSqrt"),k=g?"-=":"+=",l=g?"-=":"+=",m=d.width(),n=d.height();switch(e.direction){case"matrix":i?(k=g?"+=":"-=",f.animate({left:k+(j-1)*m+"px",top:l+n+"px"},function(){h(d)})):f.animate({left:k+m+"px"},function(){h(d)});break;case"vertical":f.animate({top:l+n+"px"},function(){h(d)});break;case"horizontal":default:f.animate({left:k+m+"px"},function(){h(d)})}}function h(b){var c=b,d=c.data("nowPage");e.pageshowfilter?e.onShiftComplete.call(c,a(e.handler,c).children(e.pageHandler).filter(":visible").eq(d-1),d):e.onShiftComplete.call(c,a(e.handler,c).children(e.pageHandler).eq(d-1),d);return!1}function g(b){var c,f=b,g=a(e.handler,f),h=e.pageshowfilter?g.children(e.pageHandler).filter(":visible"):g.children(e.pageHandler),i=0,j=0;c=h.length;switch(e.direction){case"matrix":i=Math.ceil(Math.sqrt(c)),j=Math.ceil(c/i);if(j*i>c){var k=h.filter(":first"),l=h.filter(":last"),m=j*i-c;for(var n=0;n<m;n++)k.clone().empty().removeAttr("id").removeAttr("style").addClass("matrix-blank-page").css("display","block").insertAfter(l);c=j*i}for(var n=j;n>1;n--)h.eq((n-1)*i-1).after('<br class="matrix-break-point" style="clear:both;" />');g.width(i*f.width()).height(j*f.height());break;case"vertical":g.height(c*f.height());break;case"horizontal":default:g.width(c*f.width())}h.css({display:"block"}),f.data("totalPages",c).data("matrixSqrt",i).data("matrixColumn",j).data("nowPage",1).data("initIphoneSlide",!0),a.isFunction(d)&&d.call(f)}function f(a,b,c,d){var b=b||0,f=(Math.abs(b-c)/Math.abs(d)).toPrecision(5);b=Math.floor(Math.pow(f,2)*Math.abs(e.extrashift)/(.0196*Math.abs(e.friction))),b=b>a/2?Math.floor(a/3):b;return{speed:f,shift:b}}var e=a.extend({},b,c),d=d;return this.each(function(){var b=a(this),c=a(e.handler,b),d={origX:0,origY:0,X:0,Y:0},j=0,k=1,l=0,m=0,n=navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/Android/i)?!0:!1;if(b.children().length>1){alert("The Selector("+b.attr("id")+")'s page handler can not more than one element.");return this}if(e.handler==undefined||typeof e.handler!=="string")e.handler=".iphone-slide-page-handler",b.children(":first").addClass("iphone-slide-page-handler");if(a(e.handler,b).children().length==0){alert("You have no page(s) context.");return this}if(e.pageHandler==undefined||typeof e.pageHandler!=="string")switch(c.attr("tagName").toLowerCase()){case"ul":case"ol":e.pageHandler="li";break;default:e.pageHandler=c.children(":first").attr("tagName").toLowerCase()}var o=function(a){var d=b.data("nowPage"),f=b.data("totalPages"),g=b.data("matrixSqrt");d++,d>f?d=f:i(c,!0,e.direction=="matrix"&&(d-1)%g==0),b.data("nowPage",d);return!1},p=function(a){var d=b.data("nowPage"),f=b.data("totalPages"),g=b.data("matrixSqrt");d--,d>0?i(c,!1,e.direction=="matrix"&&d%g==0):d=1,b.data("nowPage",d);return!1},q=!1,r=!1,s,t=function(a){if(r)return!1;r=!0,s=a,a.preventDefault();var f=b.data("nowPage"),g=b.data("matrixSqrt");switch(e.direction){case"matrix":d.origX=Math.ceil(f%g)===0?(1-g)*b.width():(1-Math.ceil(f%g))*b.width(),d.origY=(1-Math.ceil(f/g))*b.height();break;case"vertical":d.origY=(1-f)*b.height();break;case"horizontal":default:d.origX=(1-f)*b.width()}e.slideHandler==undefined||typeof e.slideHandler!=="string"||n===!0?n===!0?(document.getElementById(b.attr("id")).addEventListener("touchmove",u,!1),document.getElementById(b.attr("id")).addEventListener("touchend",v,!1)):b.bind("mousemove",u,!1).bind("mouseleave mouseup",v,!1):c.bind("mousemove",u,!1).bind("mouseleave mouseup",v,!1)},u=function(b){if(a.browser.msie&&!b.button)return v(b);if(r){b.preventDefault();var f=n!==!0?b:b.changedTouches[0],g=n!==!0?s:s.changedTouches[0];switch(e.direction){case"matrix":d.X=parseInt(f.pageX-g.pageX),d.Y=parseInt(f.pageY-g.pageY),c.css({top:d.origY+d.Y+"px",left:d.origX+d.X+"px"});break;case"vertical":d.Y=parseInt(f.pageY-g.pageY),c.css({top:d.origY+d.Y+"px"});break;case"horizontal":default:d.X=parseInt(f.pageX-g.pageX),c.css({left:d.origX+d.X+"px"})}}return!r},v=function(g){var i=b.data("totalPages"),j=b.data("nowPage"),k=b.data("matrixSqrt"),l=b.data("matrixColumn");e.slideHandler==undefined||typeof e.slideHandler!=="string"||n===!0?n===!0?document.getElementById(b.attr("id")).removeEventListener("touchmove",u,!1):b.unbind("mousemove",u,!1):c.unbind("mousemove",u,!1),r&&(q=g.target==s.target);var m=n!==!0?g:g.changedTouches[0],o=n!==!0?s:s.changedTouches[0];if(Math.max(Math.abs(o.pageX-m.pageX),Math.abs(o.pageY-m.pageY))<parseInt(e.sensitivity))r=!1;else{var p,t=b.width(),w=b.height(),x=Math.abs(s.timeStamp-g.timeStamp),y={X:f(t,o.pageX,m.pageX,x),Y:f(w,o.pageY,m.pageY,x)},z={X:Math.min(m.pageX-o.pageX,t),Y:Math.min(m.pageY-o.pageY,w)},A={X:"",Y:"",EX:"",EY:"",shift:Math.max(y.X.shift,y.Y.shift),speed:Math.max(y.X.speed,y.Y.speed)},B={X:Math.abs(d.X)>=b.width()*e.draglaunch||Math.abs(d.Y)>=b.height()*e.draglaunch?0:x>e.touchduring?1:Math.ceil(y.X.speed*y.X.shift/t),Y:Math.abs(d.X)>=b.width()*e.draglaunch||Math.abs(d.Y)>=b.height()*e.draglaunch?0:x>e.touchduring?1:Math.ceil(y.Y.speed*y.Y.shift/w)};if(Math.abs(d.X)>=b.width()*e.draglaunch||Math.abs(d.Y)>=b.height()*e.draglaunch)A.shift=0;p=Math.max(1/A.speed*Math.abs(e.extrashift),Math.abs(e.extrashift)*.5),p=p>e.extrashift*2?e.extrashift*2:p;switch(e.direction){case"matrix":var C=Math.ceil(j/k);B.X=B.X>k?k:Math.abs(d.X)>=b.width()*e.draglaunch?1:Math.floor(Math.abs(z.Y/z.X))>2?0:B.X,B.Y=B.Y>l?l:Math.abs(d.Y)>=b.height()*e.draglaunch?1:Math.floor(Math.abs(z.X/z.Y))>2?0:B.Y,z.X>0?(B.X=Math.min(B.X,j-k*(C-1)-1),j=j-B.X<1?1:j-B.X,A.X="+=",A.EX="-="):(B.X=Math.min(B.X,k*C-j),j=j+B.X>i?i:j+B.X,A.X="-=",A.EX="+="),d.X=d.X>0?-1*d.X:d.X,A.X+=(B.X*t+A.shift+d.X).toString()+"px",A.EX+=A.shift.toString()+"px",z.Y>0?(B.Y=Math.min(B.Y,C-1),j=j-B.Y*k<1?1:j-B.Y*k,A.Y="+=",A.EY="-="):(B.Y=k*B.Y+j>i?l-C:B.Y,j=B.Y*k>i?i:j+B.Y*k,A.Y="-=",A.EY="+="),d.Y=d.Y>0?-1*d.Y:d.Y,A.Y+=(B.Y*w+A.shift+d.Y).toString()+"px",A.EY+=A.shift.toString()+"px";break;case"vertical":B.X=0,B.Y=B.Y==0?1:B.Y>e.maxShiftPage?e.maxShiftPage:B.Y,z.Y>0?(B.Y=j-B.Y<1?j-1:B.Y,j=j-B.Y<1?1:j-B.Y,A.Y="+=",A.EY="-="):(B.Y=j+B.Y>i?i-j:B.Y,j=j+B.Y>i?i:j+B.Y,A.Y="-=",A.EY="+="),d.Y=d.Y>0?-1*d.Y:d.Y,A.X="+=0px",A.Y+=(B.Y*w+A.shift+d.Y).toString()+"px",A.EY+=A.shift.toString()+"px",A.EX="+=0px";break;case"horizontal":default:B.Y=0,B.X=B.X==0?1:B.X>e.maxShiftPage?e.maxShiftPage:B.X,z.X>0?(B.X=j-B.X<1?j-1:B.X,j=j-B.X<1?1:j-B.X,A.X="+=",A.EX="-="):(B.X=j+B.X>i?i-j:B.X,j=j+B.X>i?i:j+B.X,A.X="-=",A.EX="+="),d.X=d.X>0?-1*d.X:d.X,A.X+=(B.X*t+A.shift+d.X).toString()+"px",A.Y="+=0px",A.EX+=A.shift.toString()+"px",A.EY="+=0px"}var D=a.easing[e.easing]!==undefined?e.easing:"swing";c.animate({top:A.Y,left:A.X},p/2).animate({top:A.EY,left:A.EX},{duration:p/2,easing:D,complete:function(){r=!1,h(b)}})}n===!0?document.getElementById(b.attr("id")).removeEventListener("touchend",v,!1):b.data("nowPage",j).unbind("mouseleave mouseup",v,!1),b.data("nowPage",j);return!1};e.slideHandler==undefined||typeof e.slideHandler!=="string"||n===!0?n===!0?document.getElementById(b.attr("id")).addEventListener("touchstart",t,!1):b.bind("mousedown",t,!1).bind("click",function(a){if(q){q=!1,a.stopImmediatePropagation();return!1}},!1):c.filter(e.slideHandler).bind("mousedown",t,!1).bind("click",function(a){if(q){q=!1,a.stopImmediatePropagation();return!1}},!1),n!==!0&&(c.filter(e.nextPageHandler).bind("click",o,!1),c.filter(e.nextPageHandler).bind("click",p,!1)),g(b);return this})}})(jQuery)

